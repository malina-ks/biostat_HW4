---
title: "Untitled"
format: html
editor: visual
---

# ЗАДАНИЕ 1

## Рассмотрите следующую статистическую гипотезу.

\# Проводят некоторое исследование пациентов с артериальной гипертензией. Предположим, что внедрение нового препарата в среднем лучше снижает их давление по сравнению со стандартной терапией.

\# Задайте seed для воспроизводимости результатов (функция set.seed()). Задайте размер выборки sample_size \<- 30. Задайте значение среднего артериального давления до приема нового препарата и после.

\# Затем:

\# Сформулируйте нулевую и альтернативную гипотезы.

\# Определите уровень значимости.

\# Выберите статистический тест для проверки гипотезы и аргументируйте свой выбор.

\# Определите наблюдаемое значение статистики, а также критическое значение статистики.

\# Оцените и прокомментируйте статистическую значимость.

```{r}
# Нулевая гипотеза (H0): Среднее артериальное давление пациентов с артериальной гипертензией не изменяется после внедрения нового препарата.
# Альтернативная гипотеза (H1): Среднее артериальное давление пациентов с артериальной гипертензией снижается после внедрения нового препарата.

# Задаем seed для воспроизводимости результатов, вводим любое число
set.seed(123)
```

```{r}
# Размер выборки
sample_size <- 30
```

```{r}
# Генерируем данные для артериального давления до и после приема препарата
before <- rnorm(sample_size, mean = 140, sd = 10)  # среднее 140, стандартное отклонение 10
after <- rnorm(sample_size, mean = 130, sd = 10)   # среднее 130, стандартное отклонение 10

```

```{r}
perform_test <- function(before, after, alpha = 0.05) {
  # Проводим тест Шапиро-Уилка для данных до и после приема препарата
  shapiro_test_before <- shapiro.test(before)
  shapiro_test_after <- shapiro.test(after)
  
  # Проводим тест на равенство дисперсий
  var_test <- var.test(before, after)
  
  # Проверяем нормальность распределения и равенство дисперсий
  if (shapiro_test_before$p.value > alpha && shapiro_test_after$p.value > alpha && var_test$p.value > alpha) {
    # Для зависимых выборок
    # Если данные имеют нормальное распределение и равные дисперсии, проводим t-тест
    result <- t.test(before, after, paired = TRUE)
    print("Нормальное распределение и равенство дисперсий. Проведен t-тест:")
    print(result)
  } else {
    # Иначе, используем непараметрический тест Уилкоксона
    result <- wilcox.test(before, after, paired = TRUE)
    print("Ненормальное распределение или неравенство дисперсий. Проведен тест Уилкоксона:")
    print(result)
  }
  return(result) # Возвращаем результат теста
}

# Пример использования функции
test_result <- perform_test(before, after)
```

```{r}
# Поскольку данные приблизительно нормально распределены и дисперсии примерно равны, мы можем использовать параметрический t-тест для сравнения средних значений данных до и после приема препарата. Тест Уилкоксона, может быть применен в случае, если одно или оба из этих предположений не выполняются.
```

```{r}
# Значение p-value равно 0.004691, что меньше уровня значимости 0.05. Это означает, что у нас есть статистически значимые доказательства против нулевой гипотезы о том, что среднее артериальное давление до и после приема препарата не различается.

# Критерий t равен 3.0634, что указывает на то, что различие между средними значениями до и после приема препарата статистически значимо.

# Среднее различие между артериальным давлением до и после приема препарата составляет 7.745579 мм ртутного столба. Доверительный интервал для среднего различия составляет от 2.574403 до 12.916755 мм ртутного столба.

# Исходя из этих результатов, мы можем утверждать, что новый препарат статистически значимо снижает артериальное давление у пациентов с артериальной гипертензией.
```

```{r}
# Так как выборка небольшая перепроверим нормальность распределения и равенство дисперий с помощью визуализации.
```

```{r}
# QQ-график для данных до приема препарата
qqnorm(before)
qqline(before, col = "red")

# QQ-график для данных после приема препарата
qqnorm(after)
qqline(after, col = "red")
```

```{r}
# Создаём датафрейм с данными до и после приёма препарата
data <- data.frame(before = before, after = after)

# Строим боксплот
boxplot(data, col = c("blue", "green"), names = c("Before", "After"), ylab = "Arterial Pressure", main = "Boxplot of Arterial Pressure Before and After")

# Проводим тест на равенство дисперсий
var_test <- var.test(before, after)
print(var_test)

```

```{r}
# Значение p-value равно 0.391, что больше уровня значимости 0.05. Это означает, что нет достаточных доказательств для отвержения нулевой гипотезы о равенстве дисперсий.
# Доверительный интервал для отношения дисперсий составляет от 0.6568 до 2.8992. Так как этот интервал включает значение 1, мы не можем сделать однозначный вывод о том, что дисперсии значимо различаются.
#Следовательно, на основании результатов теста можно сделать вывод, что нет статистически значимых различий в дисперсиях между данными до и после приёма препарата и выбор t-теста обоснован.
```

```{r}

```

```{r}
# Определяем наблюдаемое значение статистики
observed_statistic <- test_result$statistic
cat("Наблюдаемое значение статистики:", observed_statistic, "\n")
```

```{r}
# Определяем критическое значение статистики
critical_value <- qt(1 - 0.05/2, df = sample_size - 1)  # двусторонний тест
cat("Критическое значение статистики:", critical_value, "\n")
```

```{r}
# Оцениваем статистическую значимость
if (abs(observed_statistic) > critical_value) {
  cat("Отвергаем нулевую гипотезу. Существует статистически значимое различие между средними артериальными давлениями до и после приема препарата.\n")
} else {
  cat("Не отвергаем нулевую гипотезу. Нет статистически значимого различия между средними артериальными давлениями до и после приема препарата.\n")
}
```

```{r}
#                                ЗАДАНИЕ 2 
# Рассмотрите следующую статистическую гипотезу.

# Существует некоторая связь между курением и развитием рака легких. Пусть у курящих людей вероятность заболеть раком легких составляет 0.8, а у некурящих — 0.2

# Рассмотрите два случая: для выборки sample_size1 <- 100 и выборки sample_size2 <- 30. Сгенерируйте данные по курению с помощью функции rep(), пусть отношение числа курящих к некурящим в каждой выборке составляет 1:1.

# Затем:

# Сформулируйте нулевую и альтернативную гипотезы.
# Определите уровень значимости.
# Выберите статистический тест для проверки гипотезы и аргументируйте свой выбор.
# Определите наблюдаемое значение статистики, а также критическое значение статистики.
# Оцените и прокомментируйте статистическую значимость.
```

```{r}
# Нулевая гипотеза (H0): Существует независимость между курением и развитием рака легких, то есть вероятность заболеть раком легких одинакова как для курящих, так и для некурящих.

# Альтернативная гипотеза (H1): Существует связь между курением и развитием рака легких, то есть вероятность заболеть раком легких различна для курящих и некурящих людей.

# Задаем вероятности заболеть раком легких для курящих и некурящих
prob_smoker <- 0.8
prob_non_smoker <- 0.2

# Задаем размеры выборок
sample_size1 <- 100
sample_size2 <- 30

# Генерируем данные о курении
smokers <- rep("Yes", sample_size1 / 2)
non_smokers <- rep("No", sample_size1 / 2)
smokers2 <- rep("Yes", sample_size2 / 2)
non_smokers2 <- rep("No", sample_size2 / 2)

# Считаем количество заболевших раком легких для каждой выборки
cases_smokers <- sum(sample(prob_smoker, replace = TRUE, size = sample_size1 / 2) > 0.5)
cases_non_smokers <- sum(sample(prob_non_smoker, replace = TRUE, size = sample_size1 / 2) > 0.5)
cases_smokers2 <- sum(sample(prob_smoker, replace = TRUE, size = sample_size2 / 2) > 0.5)
cases_non_smokers2 <- sum(sample(prob_non_smoker, replace = TRUE, size = sample_size2 / 2) > 0.5)

# Поскольку мы работаем с категориальными данными (курящие и некурящие) и вероятностью заболеть раком легких, которое не подчиняются нормальному распределению, мы можем сразу выбрать статистический z-тест для проверки гипотезы о различии в доле заболевших раком легких между курящими и некурящими. Он подходит для сравнения бинарных данных.

# Выполняем z-тест для разности долей
z_test_result1 <- prop.test(x = c(cases_smokers, cases_non_smokers), n = c(sample_size1 / 2, sample_size1 / 2), alternative = "two.sided")
z_test_result2 <- prop.test(x = c(cases_smokers2, cases_non_smokers2), n = c(sample_size2 / 2, sample_size2 / 2), alternative = "two.sided")

# Выводим результаты
print(z_test_result1)
print(z_test_result2)
```

```{r}
# Исходя из предоставленных результатов теста на равенство долей для двух выборок (одна с размером 100, другая с размером 30), можно сделать следующие выводы:

#Для обеих выборок наблюдаемое значение статистики (X-squared) значительно превышает критическое значение при любом разумном уровне значимости (p-value < 0.05). Это указывает на то, что существует статистически значимое различие между долями заболевших раком легких у курящих и некурящих в каждой из выборок.
#Для выборки размером 100 нулевая гипотеза отклоняется с крайне низким p-value (практически равным нулю), что означает, что есть статистически значимая связь между курением и развитием рака легких в этой выборке.
# Для выборки размером 30 также отклоняется нулевая гипотеза с очень низким p-value (3.186e-07), что также указывает на статистически значимую связь между курением и раком легких.
# Доверительные интервалы для разницы долей (95%) не включают ноль для обеих выборок, что также подтверждает статистическую значимость различия между курящими и некурящими в обеих выборках.
# Таким образом, на основе предоставленных результатов можно сделать вывод, что существует статистически значимая связь между курением и развитием рака легких в обеих рассмотренных выборках.
```

```{r}
#                                           Задание 3 
# Рассмотрите следующую статистическую гипотезу.

# Применение нового метода лечения синдрома раздраженного кишечника значимо меняет уровень болевых симптомов по сравнению с группой, прошедшей лечение диетотерапией.

# Исследователь избегает любых допущений, кроме того, что выборки независимы и имеют одинаковое распределение.

# Что нужно сделать:

# Сформулируйте нулевую и альтернативную гипотезы.
# Определите уровень значимости.
# Выберите статистический тест для проверки гипотезы и аргументируйте свой выбор.
# Определите наблюдаемое значение статистики, а также критическое значение статистики.
# Оцените и прокомментируйте статистическую значимость.
```

```{r}
# Нулевая гипотеза (H0): Средние значения болевых симптомов в группах, прошедших новый метод лечения и диетотерапию, одинаковы.
# Альтернативная гипотеза (H1): Средние значения болевых симптомов в группах, прошедших новый метод лечения и диетотерапию, различаются.

# В условии, исследователь избегает любых допущений, кроме того, что выборки независимы и имеют одинаковое распределение, значит данные считаются параметрическими.

# Задаем данные баллы на шкале интенсивности боли для двух групп
group1 <- c(3, 4, 5, 4, 3, 6, 4, 5, 5, 6)  # Группа с новым методом лечения
group2 <- c(5, 6, 7, 6, 5, 8, 6, 7, 7, 8)  # Группа с диетотерапией

# Определяем уровень значимости
alpha <- 0.05

# Проверим на  равенство дисперсий двух выборок с помощью F-теста
check_equal_variance <- function(group1, group2, alpha = 0.05) {
  # Выполняем F-тест на равенство дисперсий
  var_test <- var.test(group1, group2)
  
  # Выводим результаты теста
  print(var_test)
  
  # Проверяем значимость различий в дисперсиях
  if (var_test$p.value < alpha) {
    cat("Различия в дисперсиях являются статистически значимыми на уровне", alpha, "\n")
  } else {
    cat("Различия в дисперсиях не являются статистически значимыми на уровне", alpha, "\n")
  }
}

# Пример использования функции
check_equal_variance(group1, group2)

perform_test <- function(group1, group2, alpha = 0.05) {
  # Выполняем двухвыборочный t-тест
  t_test_result <- t.test(group1, group2)
  
  # Выводим результаты
  print(t_test_result)
}

# Пример использования функции
perform_test(group1, group2)
```

```{r}
# Результаты Welch Two Sample t-test указывают на статистически значимое различие между средними значениями болевых симптомов в двух группах.

# Наблюдаемое значение статистики t равно -4.1404, что указывает на значительное отклонение от нулевой гипотезы. Это означает, что средние значения болевых симптомов в группах различаются.

# P-value равно 0.0006145, что гораздо меньше выбранного уровня значимости 0.05. Это означает, что у нас есть статистически значимые доказательства против нулевой гипотезы, и мы можем отвергнуть ее.

# Доверительный интервал для разницы между средними значениями (95% доверительный интервал) составляет от -3.0148418 до -0.9851582. Это означает, что мы ожидаем, что среднее значение болевых симптомов в группе, прошедшей лечение новым методом, будет от 0.9851582 до 3.0148418 ниже, чем в группе, прошедшей лечение диетотерапией.

# Исходя из этих результатов, мы можем заключить, что новый метод лечения значимо влияет на уровень болевых симптомов по сравнению с лечением диетотерапией, причем средний уровень болевых симптомов в группе, прошедшей новый метод, значительно ниже.
```

```{r}
#                                       Задание 4
# Рассмотрите следующую гипотезу.

# Проводится исследование, в котором исследуются три противоопухолевые препарата A, B плацебо (0) на трех группах мышей. В каждой из трех групп по 10 мышей.  Оценивается размер опухоли у мыши.

# Сгенерируйте датасет следующим образом:

#tumor <- tibble(
#  therapy = c(rep("0", 10), rep("A", 10), rep("B", 10)),
#  value = c(rep(3213, 10), rep(2687, 10), rep(2423, 10))
#) %>%
#  mutate(therapy = factor(therapy, levels = c("0", "A", "B")))
#tumor$value <- tumor$value + rnorm(30, 0, 760)
# Постройте на одном графике три «ящика с усами» для наглядности.

#Проведите дисперсионный анализ, чтобы выяснить, есть ли разница между размером опухоли во всех группах. 
# Прокомментируйте получившийся результат.
# С помощью функции TukeyHSD() проведите попарные сравнения, используя критерий Тьюки.
# Прокомментируйте полученные результаты.
```

```{r}
library(tibble)
library(ggplot2)
library(dplyr)  # Загружаем пакет dplyr

# Генерируем данные
tumor <- tibble(
  therapy = c(rep("0", 10), rep("A", 10), rep("B", 10)),
  value = c(rep(3213, 10), rep(2687, 10), rep(2423, 10))
) %>%
  mutate(therapy = factor(therapy, levels = c("0", "A", "B")))
tumor$value <- tumor$value + rnorm(30, 0, 760)

# Строим "ящики с усами"
ggplot(tumor, aes(x = therapy, y = value)) +
  geom_boxplot() +
  labs(x = "Therapy", y = "Tumor Size") +
  theme_minimal()
```

```{r}
# Проводим дисперсионный анализ
anova_result <- aov(value ~ therapy, data = tumor)
summary(anova_result)
```

```{r}
# Значение F-статистики равно 5.428, а p-value составляет 0.0104, что меньше выбранного уровня значимости 0.05. Это означает, что у нас есть статистически значимые доказательства против нулевой гипотезы о том, что средние значения размера опухоли одинаковы для всех трех групп лечения.

#Значение p-value (< 0.05) позволяет нам отвергнуть нулевую гипотезу о равенстве средних во всех группах.

#Таким образом, основываясь на результатах ANOVA, мы можем сделать вывод, что существует статистически значимая разница в размере опухоли между группами лечения. Однако, ANOVA не позволяет определить, между какими конкретно группами есть различия. Для этого используется дополнительный анализ с помощью попарных сравнений, например, критерий Тьюки.
```

```{r}
# Проводим попарные сравнения с помощью критерия Тьюки
tukey_result <- TukeyHSD(anova_result)
print(tukey_result)
```

```{r}
#Разница между группой лечения B и плацебо (0) составляет -1101.696, с 95% доверительным интервалом [-1932.370, -271.022]. p-value для этого сравнения меньше выбранного уровня значимости 0.05, что указывает на статистически значимые различия.

#Разница между группой лечения A и плацебо (0) составляет -491.063, с 95% доверительным интервалом [-1321.738, 339.611]. p-value для этого сравнения больше 0.05, что указывает на отсутствие статистически значимых различий.

#Разница между группами лечения B и A составляет -610.633, с 95% доверительным интервалом [-1441.307, 220.042]. p-value для этого сравнения также больше 0.05, что указывает на отсутствие статистически значимых различий.

#Таким образом, на основе результатов критерия Тьюки мы можем заключить, что противоопухолевый препарат B значимо отличается от плацебо (0) в отличие от препарата A, а также что между препаратами A и B нет статистически значимых различий.
```
